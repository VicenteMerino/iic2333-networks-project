```
    _                                  ____            
   / \   _ __ ___   ___  _ __   __ _  |  _ \ _   _ ____
  / _ \ | '_ ` _ \ / _ \| '_ \ / _` | | |_) | | | |_  /
 / ___ \| | | | | | (_) | | | | (_| | |  _ <| |_| |/ / 
/_/   \_\_| |_| |_|\___/|_| |_|\__, | |_| \_\\__,_/___|
                               |___/                   
```
# No C me ocurre :rocket:

```
⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⣠⣤⣤⣤⣤⣤⣶⣦⣤⣄⡀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⡀⣄⣤⣦⣶⣤⣤⣤⣤⣤⣠⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠀⢀⣴⣿⡿⠛⠉⠙⠛⠛⠛⠛⠻⢿⣿⣷⣤⡀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⡀⣤⣷⣿⢿⠻⠛⠛⠛⠛⠙⠉⠛⡿⣿⣴⢀⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠀⣼⣿⠋⠀⠀⠀⠀⠀⠀⠀⢀⣀⣀⠈⢻⣿⣿⡄⠀⠀⠀⠀⠀⠀⠀⠀⡄⣿⣿⢻⠈⣀⣀⢀⠀⠀⠀⠀⠀⠀⠀⠋⣿⣼⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⣸⣿⡏⠀⠀⠀⣠⣶⣾⣿⣿⣿⠿⠿⠿⢿⣿⣿⣿⣄⠀⠀⠀⠀⠀⠀⣄⣿⣿⣿⢿⠿⠿⠿⣿⣿⣿⣾⣶⣠⠀⠀⠀⡏⣿⣸⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⣿⣿⠁⠀⠀⢰⣿⣿⣯⠁⠀⠀⠀⠀⠀⠀⠀⠈⠙⢿⣷⡄⠀⠀⡄⣷⢿⠙⠈⠀⠀⠀⠀⠀⠀⠀⠁⣯⣿⣿⢰⠀⠀⠁⣿⣿⠀⠀⠀⠀⠀⠀
⠀⠀⣀⣤⣴⣶⣶⣿⡟⠀⠀⠀⢸⣿⣿⣿⣆⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⣿⣷⠀⠀⣷⣿⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⣆⣿⣿⣿⢸⠀⠀⠀⡟⣿⣶⣶⣴⣤⣀⠀
⠀⢰⣿⡟⠋⠉⣹⣿⡇⠀⠀⠀⠘⣿⣿⣿⣿⣷⣦⣤⣤⣤⣶⣶⣶⣶⣿⣿⣿⠀⠀⣿⣿⣿⣶⣶⣶⣶⣤⣤⣤⣦⣷⣿⣿⣿⣿⠘⠀⠀⠀⡇⣿⣹⠉⠋⡟⣿⢰
⠀⢸⣿⡇⠀⠀⣿⣿⡇⠀⠀⠀⠀⠹⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⡿⠃⠀⠀⠃⡿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⠹⠀⠀⠀⠀⡇⣿⣿⠀⠀⡇⣿⢸
⠀⣸⣿⡇⠀⠀⣿⣿⡇⠀⠀⠀⠀⠀⠉⠻⠿⣿⣿⣿⣿⡿⠿⠿⠛⢻⣿⡇⠀⠀⠀⠀⡇⣿⢻⠛⠿⠿⡿⣿⣿⣿⣿⠿⠻⠉⠀⠀⠀⠀⠀⡇⣿⣿⠀⠀⡇⣿⣸
⠀⣿⣿⠁⠀⠀⣿⣿⡇⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢸⣿⣧⠀⠀⠀⠀⣧⣿⢸⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⡇⣿⣿⠀⠀⠁⣿⣿
⠀⣿⣿⠀⠀⠀⣿⣿⡇⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢸⣿⣿⠀⠀⠀⠀⣿⣿⢸⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⡇⣿⣿⠀⠀⠀⣿⣿
⠀⣿⣿⠀⠀⠀⣿⣿⡇⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢸⣿⣿⠀⠀⠀⠀⣿⣿⢸⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⡇⣿⣿⠀⠀⠀⣿⣿
⠀⢿⣿⡆⠀⠀⣿⣿⡇⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢸⣿⡇⠀⠀⠀⠀⡇⣿⢸⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⡇⣿⣿⠀⠀⡆⣿⢿
⠀⠸⣿⣧⡀⠀⣿⣿⡇⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⣿⣿⠃⠀⠀⠀⠀⠃⣿⣿⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⡇⣿⣿⠀⡀⣧⣿⠸
⠀⠀⠛⢿⣿⣿⣿⣿⣇⠀⠀⠀⠀⠀⣰⣿⣿⣷⣶⣶⣶⣶⠶⠀⢠⣿⣿⠀⠀⠀⠀⠀⠀⣿⣿⢠⠀⠶⣶⣶⣶⣶⣷⣿⣿⣰⠀⠀⠀⠀⠀⣇⣿⣿⣿⣿⢿⠛⠀
⠀⠀⠀⠀⠀⠀⠀⣿⣿⠀⠀⠀⠀⠀⣿⣿⡇⠀⣽⣿⡏⠁⠀⠀⢸⣿⡇⠀⠀⠀⠀⠀⠀⡇⣿⢸⠀⠀⠁⡏⣿⣽⠀⡇⣿⣿⠀⠀⠀⠀⠀⣿⣿⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⣿⣿⠀⠀⠀⠀⠀⣿⣿⡇⠀⢹⣿⡆⠀⠀⠀⣸⣿⠇⠀⠀⠀⠀⠀⠀⠇⣿⣸⠀⠀⠀⡆⣿⢹⠀⡇⣿⣿⠀⠀⠀⠀⠀⣿⣿⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⢿⣿⣦⣄⣀⣠⣴⣿⣿⠁⠀⠈⠻⣿⣿⣿⣿⡿⠏⠀⠀⠀⠀⠀⠀⠀⠀⠏⡿⣿⣿⣿⣿⠻⠈⠀⠁⣿⣿⣴⣠⣀⣄⣦⣿⢿⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠈⠛⠻⠿⠿⠿⠿⠋⠁⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠁⠋⠿⠿⠿⠿⠻⠛⠈⠀⠀⠀⠀⠀⠀
```

## Integrantes
| Nombre integrante | 
|  :----: |
| [kylevon](https://github.com/kylevon) |
| [VicenteMerino](https://github.com/VicenteMerino) |
| [mframos3](https://github.com/mframos3) |
| [jrrosas](https://github.com/jrrosas) |


## Instrucciones para ejecutar el programa

En primer lugar es necesario compilar el programa usando el comando:

`make`

Para ejecutar el servidor:

`./server -i -<ip_tcp> -p <port_tcp>`

Para ejecutar el cliente:

`./client -i <ip_tcp> -p <port_tcp>`

Lo anterior es para correrlo de forma local. Nuestro programa además, hace uso de *SSH Tunneling*, para ello deben seguir las siguientes instrucciones:

- Por parte del cliente:
   Se tiene que realizar el *port forwarding* con el siguiente comando desde el cliente:
    `ssh -L <port_tcp local>:iic2333.ing.puc.cl:9060 usuario@iic2333.ing.puc.cl`
  
  En `<port_tcp local>` se ingresa el puerto local que utiliza el programa del cliente.

- Por parte del servidor:
  Se tiene que ejecutar el programa del servidor utilizando el **puerto 9060** que es el designado para nuestro grupo. El proyecto está subido a la carpeta del alumno Kyle, usuario kbossonney1, contraseña 16639995 (número de alumno).

De esta forma, la información que reciba y emita el cliente hacia el puerto local del cliente, será redirigido al puerto local del servidor correspondiente al utilizado por el programa del servidor a través del *tunel ssh*. La comunicación va del puerto local (ej. 3000) --> puerto que expone el servidor (22) --> puerto local del servidor (9060) y viceversa.

## Descripción de los paquetes utilizados en la comunicación entre cliente y servidor (Protocolo de comunicación)

- id: 1 Es un paquete de tipo texto proveniente de un cliente conectado o desde el servidor hacia un cliente conectado.

- id: 9 Es un paquete de tipo texto que es enviado únicamente por el servido a un cliente tratando de desconectarse.

## Principales decisiones de diseño y supuestos adicionales

- **BONUS**: Nuestra solución hace uso tanto del **Chat Fantasma**, **Más Impostores** y **SSH Tunneling**.

- Para utilizar cualquier comando (aparte de `\start <n>`) es necesario que ya haya empezado la partida, en caso contrario se envía como mensaje. :space_invader:

- Cuando un jugador hace `\exit` además de ser considerado como expulsado, es desconectado del servidor.

- Cada vez que se termina una votación, los votos actuales se reinician a `Pass`.

- Cuando ya hay una partida en curso y se conecta un cliente nuevo, solo puede interactuar una vez que haya terminado la partida actual.

- Los jugadores tienen la habilidad de hablar con los muertos: pueden hacer `\whisper` a alguien que esté muerto, pero no pueden escucharlos (viceversa no se puede). :ghost: :speech_balloon:

- USAR `CTRL C` SE CONSIDERA UNA **MALA PRÁCTICA**. **LOS JUGADORES SOLO SE PUEDEN DESCONECTAR CON EL COMANDO `\exit`**.

## Principales funciones

### Conexión Inicial

- Cuando un jugador se conecta al servidor, este último envía un mensaje de bienvenida junto con el color del jugador que se acaba de conectar. Además se envía un mensaje al jugador indicando la cantidad de jugadores conectados.

- Para identificar los colores, se muestra el texto en el color correspondiente en la consola

- El comando `start <n>` puede ser usado por cualquier jugador conectado. El juego empieza si se cumplen las validaciones especificadas en el enunciado.

- La cantidad de jugadores es de 3 a 8 si hay un impostor, y de 5 a 8 si hay 2 impostores. Si se conecta un noveno jugador, no tendrá acceso a la partida.

### Roles y objetivos

- El impostor es escogido de forma aleatoria entre todos los participantes.

- Se avisa, cuando comienza la partida, el rol de cada jugador.

- Se cumple que los ruzmates ganan cuando el impostor es expulsado de la nave.

- Se cumple que los impostores ganan cuando quedan vivos la misma cantidad de impostores que tripulantes.

### Chat

- Se envía un mensaje cuando un jugador se ha conectado al servidor y se informa también el color

- Se envía una mensaje cuando un jugador es expulsado o eliminado y se muestra su color. Cuando el jugador es EXPULSADO se revela su rol. 

- Cuando un jugador utiliza el comando `\start <n>` se envía un mensaje a todos los jugadores indicando el rol y dando un mensaje de inicio.

- Cuando se termina la partida, se envía un mensaje de término. A continuación, se revelan los roles de cada jugador y finalmente se dicta el veredicto final que indica quién fue el equipo ganador.

- Se puede utilizar nuevamente el comando `\start <n>` una vez finalizada una partida. Si ocurre esto empieza un nuevo juego, por lo cual se reparten nuevos roles a los jugadores conectados.

- El servidor ignora cualquier mensaje que quiera enviar un jugador expulsado o eliminado. Un jugador expulsado o eliminado únicamente puede utilizar el comando `\players` y hablar por el **CHAT FANTASMA**.

### Comandos

- **Consideraciones generales de los comandos**: Solo las personas vivas pueden utilizar todos los comandos. Los muertos únicamente puede usar `\exit` y `\players`. Los comandos deben ser escritos como se especifica en el enunciado. Si no se escriben correctamente, se envía un mensaje de error correspondiente al caso o simplemente se envía el comando escrito como mensaje a todos los jugadores. 

- `\start <n>`: Al utilizar este comando, se verifica que se pueda empezar una partida, comprobando si la cantidad de jugadores es válida para la cantidad de impostores que se quieran incluir. Se notifica a cada jugador cuando la partida empieza y se envía el rol.

- `\exit`: El jugador que utiliza este comando no sólo sale de la partida, sino que se desconecta del servidor. Para efectos del juego y el resto de los Ruzmates, el jugador desconectado se considera como EXPULSADO.

- `\players`: Se informa el estado de cada jugador (vivo, expulsado, eliminado, expulasdo (desconectado)). Además se informa el voto actual de cada jugador (`Pass` si no han reailzado ningún voto).

- `\vote <color>`: El jugador crea o actualiza su voto. Cuando un jugador vot se verificasi hay mayoría para poer llegar a un veredicto. Todos los jugadores pueden usar este comando, a excepción de los jugadores que ya no se encuentren vivos.

- `\kill <color>`: El impostor intenta eliminar a alguien. Se cumple con lo pedido en el enunciado, de que haya cierta probabilidad para efectivamente eliminar a un jugador. Dependiendo del resultado del evento probabilístico se decide si el jugador es eliminado, se manda un aviso privado o un aviso público de intento de asesinato.

- `\spy <color>`: Este comando se puede utilizar una única vez en toda la partida. Sólo lo pueden utilizar los Ruzmates. El jugador que usa el comando obtiene de forma privada el rol del jugador espiado.

- `\whisper <color> <mensaje>`: Este comando envía un mensaje de forma privada a un jugador. Se envía también un mensaje al jugador que realiza esta acción indicando que el mensaje enviado fue exitoso.
